<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LootMap3 â€” World Map</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cinzel:wght@400;600&family=IM+Fell+English+SC&display=swap" rel="stylesheet"/>
<style>
  :root {
    --cave:    #7c5ccc;
    --cave-dim:#3d2d6e;
    --castle:  #c0392b;
    --castle-dim:#6e1a13;
    --forest:  #27ae60;
    --forest-dim:#0e4a28;
    --shared:  #d4a017;
    --shared-dim:#6e500a;
    --boss:    #ff4500;
    --bg:      #0a0a12;
    --panel:   #11111e;
    --line:    rgba(255,255,255,0.07);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: var(--bg);
    font-family: 'Cinzel', serif;
    color: #ddd;
    overflow-x: auto;
    min-height: 100vh;
  }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    text-align: center;
    padding: 28px 20px 10px;
    background: linear-gradient(180deg, #0d0d1f 0%, transparent 100%);
    position: relative;
  }
  header h1 {
    font-family: 'Cinzel Decorative', cursive;
    font-size: clamp(1.2rem, 3vw, 2.2rem);
    letter-spacing: .15em;
    background: linear-gradient(135deg, #a78bfa, #f59e0b, #34d399);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: none;
  }
  header p {
    font-family: 'IM Fell English SC', serif;
    font-size: .78rem;
    color: #666;
    margin-top: 4px;
    letter-spacing: .2em;
  }

  /* â”€â”€ LEGEND â”€â”€ */
  .legend {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 14px;
    padding: 14px 20px 6px;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 7px;
    font-size: .7rem;
    letter-spacing: .08em;
    color: #aaa;
  }
  .legend-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  /* â”€â”€ CANVAS WRAPPER â”€â”€ */
  .canvas-wrap {
    width: 100%;
    overflow-x: auto;
    padding: 10px 20px 30px;
  }
  svg {
    display: block;
    margin: 0 auto;
    font-family: 'Cinzel', serif;
  }

  /* â”€â”€ NODE STYLES â”€â”€ */
  .node-circle {
    cursor: pointer;
    transition: filter .2s;
  }
  .node-circle:hover { filter: brightness(1.5) drop-shadow(0 0 8px currentColor); }

  /* â”€â”€ TOOLTIP â”€â”€ */
  #tooltip {
    position: fixed;
    background: #11111edd;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 10px 14px;
    font-size: .72rem;
    line-height: 1.7;
    pointer-events: none;
    z-index: 9999;
    display: none;
    max-width: 220px;
    box-shadow: 0 4px 24px #000a;
  }
  #tooltip .tt-name { font-size: .9rem; font-weight: 600; margin-bottom: 4px; }
  #tooltip .tt-biome { font-size: .65rem; letter-spacing: .12em; margin-bottom: 6px; color: #888; }
  #tooltip .tt-row { display: flex; gap: 6px; }
  #tooltip .tt-label { color: #777; min-width: 62px; }
  #tooltip .tt-val { color: #eee; }
  #tooltip .loot-badge {
    display: inline-block;
    margin-top: 6px;
    background: #d4a01733;
    border: 1px solid #d4a017;
    border-radius: 4px;
    padding: 1px 7px;
    font-size: .62rem;
    color: #d4a017;
    letter-spacing: .1em;
  }
</style>
</head>
<body>

<header>
  <h1>LootMap 3 â€” World Map</h1>
  <p>Cave &nbsp;Â·&nbsp; Castle &nbsp;Â·&nbsp; Forest &nbsp;Â·&nbsp; Shared Convergence</p>
</header>

<div class="legend">
  <div class="legend-item"><div class="legend-dot" style="background:#7c5ccc"></div>Cave Path</div>
  <div class="legend-item"><div class="legend-dot" style="background:#c0392b"></div>Castle Path</div>
  <div class="legend-item"><div class="legend-dot" style="background:#27ae60"></div>Forest Path</div>
  <div class="legend-item"><div class="legend-dot" style="background:#d4a017"></div>Shared Final</div>
  <div class="legend-item"><div class="legend-dot" style="background:#ff4500"></div>Boss Node</div>
  <div class="legend-item"><div class="legend-dot" style="background:#4fc3f7; border:2px solid #fff4"></div>Loot Node âœ¦</div>
  <div class="legend-item"><div class="legend-dot" style="background:#555; border:2px dashed #e74c3c88"></div>Trap Node âš </div>
  <div class="legend-item"><div class="legend-dot" style="background:#555; border:2px solid #3498db88"></div>NPC Merchant</div>
</div>

<div class="canvas-wrap">
  <svg id="map" viewBox="0 0 1300 820" width="1300" height="820"></svg>
</div>

<div id="tooltip"></div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MAP DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const nodes = {
  // CAVE PATH (left column, top area)
  C_1:  { biome:'Cave',   type:'Battle', enemies:['BatSwarm','MireGrub'],             traps:[],                  npcs:[],         loot:false, connections:['C_2','C_3'] },
  C_2:  { biome:'Cave',   type:'Battle', enemies:['RockGolem','DeepGnome'],            traps:[],                  npcs:[],         loot:false, connections:['C_1','C_4'] },
  C_3:  { biome:'Cave',   type:'Battle', enemies:['CaveTroll','Zombie'],               traps:[],                  npcs:[],         loot:false, connections:['C_1','C_4'] },
  C_4:  { biome:'Cave',   type:'Npc',    enemies:[],                                  traps:[],                  npcs:['Merchant'],loot:false, connections:['C_2','C_3','C_5','C_6'] },
  C_5:  { biome:'Cave',   type:'Battle', enemies:['BlindStalker','CrystalSpider'],     traps:[],                  npcs:[],         loot:false, connections:['C_4','C_7'] },
  C_6:  { biome:'Cave',   type:'Battle', enemies:['GloomWraith','Demon'],              traps:[],                  npcs:[],         loot:false, connections:['C_4','C_7'] },
  C_7:  { biome:'Cave',   type:'Trap',   enemies:[],                                  traps:['Stalactite Collapse'],npcs:[],       loot:false, connections:['C_5','C_6','C_8','C_9'] },
  C_8:  { biome:'Cave',   type:'Battle', enemies:['StoneSerpent','EchoLich'],          traps:[],                  npcs:[],         loot:true,  connections:['C_7','C_10'] },
  C_9:  { biome:'Cave',   type:'Battle', enemies:['Wizard','CrystalSpider','MireGrub'],traps:[],                  npcs:[],         loot:false, connections:['C_7','C_10'] },
  C_10: { biome:'Cave',   type:'Boss',   enemies:['CaveWarden'],                      traps:[],                  npcs:[],         loot:true,  connections:['C_8','C_9','S_1'] },

  // CASTLE PATH (middle column)
  K_1:  { biome:'Castle', type:'Battle', enemies:['KnightGuard','GargoyleWatch'],      traps:[],                  npcs:[],         loot:false, connections:['K_2','K_3'] },
  K_2:  { biome:'Castle', type:'Battle', enemies:['ShadowArcher','CursedSteward'],     traps:[],                  npcs:[],         loot:false, connections:['K_1','K_4'] },
  K_3:  { biome:'Castle', type:'Battle', enemies:['Zombie','KnightGuard'],             traps:[],                  npcs:[],         loot:false, connections:['K_1','K_4'] },
  K_4:  { biome:'Castle', type:'Npc',    enemies:[],                                  traps:[],                  npcs:['Merchant'],loot:false, connections:['K_2','K_3','K_5','K_6'] },
  K_5:  { biome:'Castle', type:'Battle', enemies:['IronGolem','DreadSentinel'],        traps:[],                  npcs:[],         loot:false, connections:['K_4','K_7'] },
  K_6:  { biome:'Castle', type:'Battle', enemies:['BansheeNoble','Demon'],             traps:[],                  npcs:[],         loot:false, connections:['K_4','K_7'] },
  K_7:  { biome:'Castle', type:'Trap',   enemies:[],                                  traps:['Portcullis Slam'], npcs:[],         loot:false, connections:['K_5','K_6','K_8','K_9'] },
  K_8:  { biome:'Castle', type:'Battle', enemies:['SpectralKnight','ChainWraith'],     traps:[],                  npcs:[],         loot:true,  connections:['K_7','K_10'] },
  K_9:  { biome:'Castle', type:'Battle', enemies:['VoidCaster','Wizard','CursedSteward'],traps:[],               npcs:[],         loot:false, connections:['K_7','K_10'] },
  K_10: { biome:'Castle', type:'Boss',   enemies:['CastleOverlord'],                  traps:[],                  npcs:[],         loot:true,  connections:['K_8','K_9','S_1'] },

  // FOREST PATH (right column)
  F_1:  { biome:'Forest', type:'Battle', enemies:['ThornSprite','DuskRaven'],          traps:[],                  npcs:[],         loot:false, connections:['F_2','F_3'] },
  F_2:  { biome:'Forest', type:'Battle', enemies:['FangWolf','SporeWalker'],           traps:[],                  npcs:[],         loot:false, connections:['F_1','F_4'] },
  F_3:  { biome:'Forest', type:'Battle', enemies:['WillOWisp','Zombie'],               traps:[],                  npcs:[],         loot:false, connections:['F_1','F_4'] },
  F_4:  { biome:'Forest', type:'Npc',    enemies:[],                                  traps:[],                  npcs:['Merchant'],loot:false, connections:['F_2','F_3','F_5','F_6'] },
  F_5:  { biome:'Forest', type:'Battle', enemies:['MossGiant','BrambleFiend'],         traps:[],                  npcs:[],         loot:false, connections:['F_4','F_7'] },
  F_6:  { biome:'Forest', type:'Battle', enemies:['GreenHag','Demon'],                 traps:[],                  npcs:[],         loot:false, connections:['F_4','F_7'] },
  F_7:  { biome:'Forest', type:'Trap',   enemies:[],                                  traps:['Enchanted Snare'], npcs:[],         loot:false, connections:['F_5','F_6','F_8','F_9'] },
  F_8:  { biome:'Forest', type:'Battle', enemies:['RootElemental','AncientDryad'],     traps:[],                  npcs:[],         loot:true,  connections:['F_7','F_10'] },
  F_9:  { biome:'Forest', type:'Battle', enemies:['Wizard','ThornSprite','SporeWalker'],traps:[],                 npcs:[],         loot:false, connections:['F_7','F_10'] },
  F_10: { biome:'Forest', type:'Boss',   enemies:['ForestAncient'],                   traps:[],                  npcs:[],         loot:true,  connections:['F_8','F_9','S_1'] },

  // SHARED
  S_1:        { biome:'Shared', type:'Npc',    enemies:[],                                              traps:[],                    npcs:['Merchant'], loot:false, connections:['C_10','K_10','F_10','S_2'] },
  S_2:        { biome:'Shared', type:'Battle', enemies:['Demon','Wizard','ChainWraith','EchoLich'],      traps:[],                    npcs:[],           loot:false, connections:['S_1','S_3'] },
  S_3:        { biome:'Shared', type:'Trap',   enemies:[],                                              traps:['Collapsing Floor'],   npcs:[],           loot:false, connections:['S_2','S_4'] },
  S_4:        { biome:'Shared', type:'Battle', enemies:['AncientDryad','VoidCaster','EchoLich','Zombie','Demon'], traps:[], npcs:[], loot:true,  connections:['S_3','S_5'] },
  S_5:        { biome:'Shared', type:'Boss',   enemies:['GrandHeraldOfRuin'],                           traps:[],                    npcs:[],           loot:true,  connections:['S_4','FINAL_BOSS'] },
  FINAL_BOSS: { biome:'Shared', type:'FinalBoss', enemies:['EternalWarplet'],                           traps:[],                    npcs:[],           loot:true,  connections:['S_5'] },
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LAYOUT POSITIONS
// Each biome gets its own lane; shared nodes center
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Grid layout: x = biome lane, y = tier (top to bottom = path start to boss)
// Cave: x ~170    Castle: x ~650    Forest: x ~1130
// Branching: offset Â±70 for branch nodes

const W = 1300, H = 820;
const CAVE_X = 170, CASTLE_X = 650, FOREST_X = 1130;
const SHARED_X = 650;

// Tier Y positions for path nodes (10 per biome)
const tiers = {
  1:  55,   // entry
  2:  130,  // branch A
  3:  130,  // branch B (offset right)
  4:  220,  // merchant
  5:  300,  // branch A
  6:  300,  // branch B
  7:  390,  // trap
  8:  470,  // mini-boss branch A
  9:  470,  // branch B
  10: 560,  // biome boss
};

// Shared final nodes
const sharedTiers = {
  S_1:        680,
  S_2:        730,
  S_3:        760,
  S_4:        790,
  S_5:        760,
  FINAL_BOSS: 810,
};

// Manual x offsets for branching within a biome
const branchOffset = 65; // px left/right of center

const positions = {};

function setPos(id, x, y) { positions[id] = {x, y}; }

// CAVE
setPos('C_1',  CAVE_X,                tiers[1]);
setPos('C_2',  CAVE_X - branchOffset, tiers[2]);
setPos('C_3',  CAVE_X + branchOffset, tiers[3]);
setPos('C_4',  CAVE_X,                tiers[4]);
setPos('C_5',  CAVE_X - branchOffset, tiers[5]);
setPos('C_6',  CAVE_X + branchOffset, tiers[6]);
setPos('C_7',  CAVE_X,                tiers[7]);
setPos('C_8',  CAVE_X - branchOffset, tiers[8]);
setPos('C_9',  CAVE_X + branchOffset, tiers[9]);
setPos('C_10', CAVE_X,                tiers[10]);

// CASTLE
setPos('K_1',  CASTLE_X,                tiers[1]);
setPos('K_2',  CASTLE_X - branchOffset, tiers[2]);
setPos('K_3',  CASTLE_X + branchOffset, tiers[3]);
setPos('K_4',  CASTLE_X,                tiers[4]);
setPos('K_5',  CASTLE_X - branchOffset, tiers[5]);
setPos('K_6',  CASTLE_X + branchOffset, tiers[6]);
setPos('K_7',  CASTLE_X,                tiers[7]);
setPos('K_8',  CASTLE_X - branchOffset, tiers[8]);
setPos('K_9',  CASTLE_X + branchOffset, tiers[9]);
setPos('K_10', CASTLE_X,                tiers[10]);

// FOREST
setPos('F_1',  FOREST_X,                tiers[1]);
setPos('F_2',  FOREST_X - branchOffset, tiers[2]);
setPos('F_3',  FOREST_X + branchOffset, tiers[3]);
setPos('F_4',  FOREST_X,                tiers[4]);
setPos('F_5',  FOREST_X - branchOffset, tiers[5]);
setPos('F_6',  FOREST_X + branchOffset, tiers[6]);
setPos('F_7',  FOREST_X,                tiers[7]);
setPos('F_8',  FOREST_X - branchOffset, tiers[8]);
setPos('F_9',  FOREST_X + branchOffset, tiers[9]);
setPos('F_10', FOREST_X,                tiers[10]);

// SHARED (linear funnel, center)
setPos('S_1',        SHARED_X,          610);
setPos('S_2',        SHARED_X,          665);
setPos('S_3',        SHARED_X,          710);
setPos('S_4',        SHARED_X,          755);
setPos('S_5',        SHARED_X,          790);
setPos('FINAL_BOSS', SHARED_X,          810); // pushed down later

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// COLORS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const biomeColor = {
  Cave:    '#7c5ccc',
  Castle:  '#c0392b',
  Forest:  '#27ae60',
  Shared:  '#d4a017',
};
const typeIcon = {
  Battle:    'âš”',
  Npc:       'ðŸ›’',
  Trap:      'âš ',
  Boss:      'ðŸ’€',
  FinalBoss: 'â˜ ',
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const svg = document.getElementById('map');
const NS = 'http://www.w3.org/2000/svg';

function el(tag, attrs, parent) {
  const e = document.createElementNS(NS, tag);
  for (const [k,v] of Object.entries(attrs)) e.setAttribute(k,v);
  if (parent) parent.appendChild(e);
  return e;
}

// Defs: glow filters + gradients
const defs = el('defs', {}, svg);

const biomeDefs = [
  ['cave-glow',    '#7c5ccc'],
  ['castle-glow',  '#c0392b'],
  ['forest-glow',  '#27ae60'],
  ['shared-glow',  '#d4a017'],
  ['boss-glow',    '#ff4500'],
];
biomeDefs.forEach(([id, color]) => {
  const f = el('filter', {id, x:'-50%', y:'-50%', width:'200%', height:'200%'}, defs);
  const fe = el('feDropShadow', {dx:'0', dy:'0', stdDeviation:'4', 'flood-color': color, 'flood-opacity':'0.8'}, f);
});

// Radial bg gradients per biome lane
[
  [CAVE_X,    '#1a0d3a', 240],
  [CASTLE_X,  '#2d0a08', 240],
  [FOREST_X,  '#0a2d14', 240],
].forEach(([cx, color, r]) => {
  const g = el('radialGradient', {id:`bg-${cx}`, cx:'50%', cy:'50%', r:'50%', gradientUnits:'userSpaceOnUse',
    x1:0, y1:0, x2:0, y2:1, fx: cx, fy: 350, r: r}, defs);
  el('stop', {offset:'0%',   'stop-color': color, 'stop-opacity':'1'}, g);
  el('stop', {offset:'100%', 'stop-color': '#0a0a12', 'stop-opacity':'0'}, g);
});

// Background
el('rect', {x:0, y:0, width:W, height:H, fill:'#0a0a12'}, svg);

// Subtle lane bg strips
[
  [CAVE_X,    '#7c5ccc', 200],
  [CASTLE_X,  '#c0392b', 200],
  [FOREST_X,  '#27ae60', 200],
].forEach(([cx, color, w]) => {
  el('rect', {x: cx-w/2, y:0, width:w, height:600, rx:0,
    fill: color, opacity:'0.04'}, svg);
});

// Shared zone bg
el('rect', {x: 300, y:580, width:700, height:240, rx:12,
  fill:'#d4a017', opacity:'0.04'}, svg);

// Biome labels
[
  [CAVE_X,    'CAVE',    '#7c5ccc'],
  [CASTLE_X,  'CASTLE',  '#c0392b'],
  [FOREST_X,  'FOREST',  '#27ae60'],
].forEach(([x, label, color]) => {
  const t = el('text', {x, y:22, 'text-anchor':'middle',
    fill: color, opacity:'0.6',
    style:`font-family:'Cinzel Decorative',cursive;font-size:11px;letter-spacing:.18em`}, svg);
  t.textContent = label;
});
const shLabel = el('text', {x: SHARED_X, y:600, 'text-anchor':'middle',
  fill:'#d4a017', opacity:'0.7',
  style:`font-family:'Cinzel Decorative',cursive;font-size:10px;letter-spacing:.2em`}, svg);
shLabel.textContent = 'â€” CONVERGENCE â€”';

// â”€â”€ Draw edges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const edgeGroup = el('g', {opacity:'0.55'}, svg);

const drawnEdges = new Set();
for (const [id, node] of Object.entries(nodes)) {
  for (const conn of node.connections) {
    const key = [id, conn].sort().join('|');
    if (drawnEdges.has(key)) continue;
    drawnEdges.add(key);
    const a = positions[id], b = positions[conn];
    if (!a || !b) continue;
    const color = id.startsWith('S') || conn.startsWith('S') || id === 'FINAL_BOSS' || conn === 'FINAL_BOSS'
      ? '#d4a017' : biomeColor[node.biome] || '#666';

    // Curved path for branches, straight for linear
    const dx = b.x - a.x, dy = b.y - a.y;
    const cx1 = a.x + dx*0.1, cy1 = a.y + dy*0.6;
    const cx2 = b.x - dx*0.1, cy2 = b.y - dy*0.4;
    const d = Math.abs(dx) < 5
      ? `M${a.x},${a.y} L${b.x},${b.y}`
      : `M${a.x},${a.y} C${cx1},${cy1} ${cx2},${cy2} ${b.x},${b.y}`;

    el('path', {d, fill:'none', stroke: color,
      'stroke-width': id.startsWith('S') || conn.startsWith('S') ? '1.5' : '1.2',
      'stroke-dasharray': node.type === 'Trap' || nodes[conn]?.type === 'Trap' ? '4,3' : 'none'
    }, edgeGroup);
  }
}

// Convergence lines from biome bosses to S_1
['C_10','K_10','F_10'].forEach(bossId => {
  const a = positions[bossId], b = positions['S_1'];
  const mx = (a.x+b.x)/2, my = (a.y+b.y)/2 + 20;
  el('path', {
    d: `M${a.x},${a.y} Q${mx},${my} ${b.x},${b.y}`,
    fill:'none', stroke:'#d4a017', 'stroke-width':'1.5', opacity:'0.7'
  }, edgeGroup);
});

// â”€â”€ Draw nodes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const nodeGroup = el('g', {}, svg);

for (const [id, node] of Object.entries(nodes)) {
  const pos = positions[id];
  if (!pos) continue;

  const color = node.type === 'FinalBoss' ? '#ff4500'
              : node.biome === 'Shared'   ? '#d4a017'
              : biomeColor[node.biome]    || '#888';

  const r = node.type === 'FinalBoss' ? 20
          : node.type === 'Boss'       ? 16
          : node.type === 'Npc'        ? 13
          : 11;

  const glow = node.biome === 'Cave'   ? 'url(#cave-glow)'
             : node.biome === 'Castle' ? 'url(#castle-glow)'
             : node.biome === 'Forest' ? 'url(#forest-glow)'
             : node.type === 'FinalBoss' ? 'url(#boss-glow)'
             : 'url(#shared-glow)';

  const g = el('g', {class:'node-circle', transform:`translate(${pos.x},${pos.y})`}, nodeGroup);

  // Outer ring for loot nodes
  if (node.loot) {
    el('circle', {r: r+4, fill:'none', stroke:'#d4a017', 'stroke-width':'1',
      'stroke-dasharray':'3,2', opacity:'0.7'}, g);
  }

  // Main circle
  const fillColor = node.type === 'Trap' ? '#1e1e2e' : '#11111e';
  el('circle', {r, fill: fillColor, stroke: color, 'stroke-width': node.type==='FinalBoss'?3:1.8,
    filter: node.type === 'Boss' || node.type === 'FinalBoss' || node.loot ? glow : 'none'
  }, g);

  // Icon
  const icon = el('text', {
    x:0, y: node.type==='FinalBoss'?6:4,
    'text-anchor':'middle',
    style:`font-size:${node.type==='FinalBoss'?12: node.type==='Boss'?10:8}px`
  }, g);
  icon.textContent = typeIcon[node.type] || 'âš”';

  // Label below node
  const label = el('text', {
    x:0, y: r + 11,
    'text-anchor':'middle',
    fill: color,
    style:`font-size:7.5px;letter-spacing:.06em;font-family:'Cinzel',serif;font-weight:600`
  }, g);
  label.textContent = id;

  // Tooltip interaction
  g.addEventListener('mouseenter', (e) => {
    const tt = document.getElementById('tooltip');
    let html = `<div class="tt-name" style="color:${color}">${typeIcon[node.type]} ${id}</div>`;
    html += `<div class="tt-biome">${node.biome.toUpperCase()} Â· ${node.type.toUpperCase()}</div>`;
    if (node.enemies.length) html += `<div class="tt-row"><span class="tt-label">Enemies:</span><span class="tt-val">${node.enemies.join(', ')}</span></div>`;
    if (node.traps.length)   html += `<div class="tt-row"><span class="tt-label">Trap:</span><span class="tt-val">${node.traps.join(', ')}</span></div>`;
    if (node.npcs.length)    html += `<div class="tt-row"><span class="tt-label">NPC:</span><span class="tt-val">${node.npcs.join(', ')}</span></div>`;
    html += `<div class="tt-row"><span class="tt-label">Connects:</span><span class="tt-val">${node.connections.join(', ')}</span></div>`;
    if (node.loot) html += `<div class="loot-badge">âœ¦ LOOT NODE</div>`;
    tt.innerHTML = html;
    tt.style.display = 'block';
  });
  g.addEventListener('mousemove', (e) => {
    const tt = document.getElementById('tooltip');
    tt.style.left = (e.clientX + 14) + 'px';
    tt.style.top  = (e.clientY - 10) + 'px';
  });
  g.addEventListener('mouseleave', () => {
    document.getElementById('tooltip').style.display = 'none';
  });
}
</script>
</body>
</html>
